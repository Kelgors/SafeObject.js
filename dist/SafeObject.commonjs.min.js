"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),SafeObject=function(){function e(){_classCallCheck(this,e),this._clearAllInstanceProperties(e.SAFE_OBJECT_INITIALIZE),this._isSafeObject=!0}return _createClass(e,null,[{key:"debug",value:function(e){var t=[];return t.push("----- SafeObject debug -----"),t.push("Constructor: "+String(e.constructor.name)),t.push("_isSafeObject: "+String(e._isSafeObject)),e._isSafeObject&&!function(){e._getAncestors();t.push("Ancestors: "+e._getAncestors().map(function(e){return e.name}).join(" > "));var r=e._getRegisteredPropertyNames(),n=e._getIgnoredPropertyNames().concat(r),s=Object.getOwnPropertyNames(e).filter(function(e){return-1===n.indexOf(e)});t.push("registered attributes: "+r.join(", ")),t.push("unregistered attributes: "+s.join(", "))}(),t.join("\n")}},{key:"include",value:function(t){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(t._isSafeObject)return t;["destroy","_getAncestors","_getRegisteredProperties","_getRegisteredPropertyNames","_getIgnoredPropertyNames","_getUnregisteredPropertyNames","_clearAllInstanceProperties","_parsePropertyDescriptor"].forEach(function(n){(!t[n]||t[n]&&r.force)&&(t[n]=e.prototype[n])}),t._isSafeObject=!0;var n=t.constructor.INSTANCE_PROPERTIES;return n&&n.length&&t._clearAllInstanceProperties(e.SAFE_OBJECT_INITIALIZE),t}}]),_createClass(e,[{key:"destroy",value:function(){this._clearAllInstanceProperties(e.SAFE_OBJECT_DESTROY)}},{key:"_getAncestors",value:function(){for(var e=this.constructor,t=[];e=Object.getPrototypeOf(e.prototype)?Object.getPrototypeOf(e.prototype).constructor:null;)t.push(e||[]);return t}},{key:"_getIgnoredPropertyNames",value:function(){return["_isSafeObject","destroy","_getAncestors","_getRegisteredProperties","_getRegisteredPropertyNames","_getUnregisteredPropertyNames","_getIgnoredPropertyNames","_clearAllInstanceProperties","_parsePropertyDescriptor"]}},{key:"_getRegisteredProperties",value:function(){for(var e=[this.constructor].concat(this._getAncestors()),t=[],r=0;r<e.length;r++)t.push.apply(t,e[r].INSTANCE_PROPERTIES);return t}},{key:"_getRegisteredPropertyNames",value:function(){return this._getRegisteredProperties().map(function(e){return Array.isArray(e)?e[0]:e})}},{key:"_getUnregisteredPropertyNames",value:function(){var e=this._getRegisteredPropertyNames();return Object.getOwnPropertyNames(this).filter(function(t){return-1===e.indexOf(t)})}},{key:"_clearAllInstanceProperties",value:function(t){for(var r=(this.constructor,this._getRegisteredProperties()),n=0;n<r.length;n++)try{var s=r[n],o=void 0,i=void 0;"string"==typeof s?(o=s,i=this._parsePropertyDescriptor()):Array.isArray(s)&&(o=s[0],i=this._parsePropertyDescriptor(s[1])),t===e.SAFE_OBJECT_INITIALIZE&&o&&i?Object.defineProperty(this,o,i):t===e.SAFE_OBJECT_DESTROY&&o&&(this[o]&&"function"==typeof this[o].destroy&&this._isSafeObject&&this[o].destroy(),this[o]=null)}catch(a){console.log("SafeObject#_clearAllInstanceProperties: "+a.toString())}}},{key:"_parsePropertyDescriptor",value:function(e){if(!e||e.constructor!==Object)return{writable:!0,configurable:!0,enumerable:!0,value:null};var t=e;return"value"in t||(t.value=null),"enumerable"in t||(t.enumerable=!0),"configurable"in t||(t.configurable=!0),"writable"in t||(t.writable=!0),t}}]),e}();exports["default"]=SafeObject,SafeObject.SAFE_OBJECT_INITIALIZE=1,SafeObject.SAFE_OBJECT_DESTROY=2;