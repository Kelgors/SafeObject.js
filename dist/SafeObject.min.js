"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();!function(e){function t(){"undefined"!=typeof console&&s.debugMode&&(console.warn?console.warn.apply(console,arguments):console.log&&console.log.apply(console,arguments))}var r=[],n=function(){function e(t,r,n,o,i){_classCallCheck(this,e),this.enumerable="undefined"==typeof r||r,this.writable="undefined"==typeof n||n,this.configurable="undefined"==typeof o||o;var u=s.getRegisteredConstructor(t);u?(this.value=u.construct.bind(u),this.isFactory=!0):(this.isFactory="function"==typeof t&&"undefined"==typeof i||(i||!1),this.value=t)}return _createClass(e,[{key:"clone",value:function(){return new e(this.value,this.enumerable,this.writable,this.configurable,this.isFactory)}},{key:"toObject",value:function(){return{value:this.isFactory?this.value(this):this.value,enumerable:this.enumerable,writable:this.writable,configurable:this.configurable}}},{key:"toNullObject",value:function(){return{value:null,enumerable:this.enumerable,writable:this.writable,configurable:this.configurable}}}]),e}(),o=function(){function e(t){_classCallCheck(this,e),this.ConstructorFunction=t}return _createClass(e,[{key:"construct",value:function(){return new this.ConstructorFunction}}]),e}(),s=function(){function e(){_classCallCheck(this,e),e.setInstanceProperties(this,e.SAFE_OBJECT_INITIALIZE),this._isDestroyed=!1}return _createClass(e,null,[{key:"debug",value:function(t){var r=[];return r.push("----- SafeObject debug -----"),r.push("Constructor: "+String(t.constructor.name)),r.push("_isSafeObject: "+String(!!t._isSafeObject)),t._isSafeObject&&!function(){var n=e.getAncestors(t);r.push("Ancestors: "+n.map(function(e){return e.name}).join(" < "));var o=e.getRegisteredPropertyNames(t),s="function"==typeof t._getIgnoredSafeObjectPropertyNames?t._getIgnoredSafeObjectPropertyNames():[],i=s.concat(o),u=Object.getOwnPropertyNames(t).filter(function(e){return i.indexOf(e)===-1});r.push("ignored properties: "+s.join(", ")),r.push("registered properties: "+o.join(", ")),r.push("unregistered properties: "+u.join(", "))}(),r.join("\n")}},{key:"include",value:function(t){if(t.constructor===Object)throw"Cannot include an Object";if(e.isSafeObject(t))return t;t._isDestroyed=!1,t.constructor.INSTANCE_PROPERTIES||(t.constructor.INSTANCE_PROPERTIES={});var r=e.getRegisteredProperties(t);if(!("_isSafeObject"in r)){var o=e.getAncestors(t).reverse(),s=o.find(function(e){return!!e.INSTANCE_PROPERTIES});s||(s=t.constructor),r._isSafeObject=s.INSTANCE_PROPERTIES._isSafeObject=new n((!0),(!1),(!1),(!0))}return"function"!=typeof t._getIgnoredSafeObjectPropertyNames&&(t._getIgnoredSafeObjectPropertyNames=e.prototype._getIgnoredSafeObjectPropertyNames),e.setProperties(t,e.SAFE_OBJECT_INITIALIZE,r),t}},{key:"getRegisteredConstructor",value:function(e){return r.find(function(t){return t.ConstructorFunction===e})}},{key:"registerConstructor",value:function(e){r.push(new o(e))}},{key:"unregisterConstructor",value:function(e){var t=r.findIndex(function(t){return t.ConstructorFunction===e});return r.splice(t,1)[0]}},{key:"isSafeObject",value:function(e){return e&&e._isSafeObject===!0}},{key:"getAncestors",value:function(e){for(var t=e.constructor,r=[];t=Object.getPrototypeOf(t.prototype)?Object.getPrototypeOf(t.prototype).constructor:null;)r.push(t||[]);return r}},{key:"getRegisteredProperties",value:function(t){var r=[t.constructor].concat(e.getAncestors(t)).map(function(e){return e.INSTANCE_PROPERTIES}).reverse();return Object.assign.apply(Object,[{}].concat(_toConsumableArray(r)))}},{key:"getUnregisteredPropertyNames",value:function(t){var r=e.getRegisteredPropertyNames(t),n="function"==typeof t._getIgnoredSafeObjectPropertyNames?t._getIgnoredSafeObjectPropertyNames():[];return r.push.apply(r,n),Object.getOwnPropertyNames(t).filter(function(e){return r.indexOf(e)===-1})}},{key:"getRegisteredPropertyNames",value:function(t){return Object.getOwnPropertyNames(e.getRegisteredProperties(t))}},{key:"setInstanceProperties",value:function(t,r){e.setProperties(t,r,e.getRegisteredProperties(t))}},{key:"setProperties",value:function(r,n,o){for(var s in o)try{var i=e.parsePropertyDescriptor(o[s]);e.setProperty(r,s,i,n)}catch(u){t("SafeObject#setProperties: "+u.toString())}}},{key:"setProperty",value:function(r,n,o,s){if(!o)return void t("Property descriptor isnt well formed for "+String(n)+".");var i=void 0;s===e.SAFE_OBJECT_DESTROY?i=o.toNullObject():s===e.SAFE_OBJECT_INITIALIZE&&(i=o.toObject()),Object.defineProperty(r,n,i)}},{key:"parsePropertyDescriptor",value:function(e){return e&&e instanceof n?e:new n(e)}}]),_createClass(e,[{key:"destroy",value:function(){e.setInstanceProperties(this,e.SAFE_OBJECT_DESTROY),this._isDestroyed=!0}},{key:"_getIgnoredSafeObjectPropertyNames",value:function(){return["_isDestroyed"]}}]),e}();s.debugMode=!1,s.VERSION="1.2.2",s.SAFE_OBJECT_INITIALIZE=1,s.SAFE_OBJECT_DESTROY=2,s.INSTANCE_PROPERTIES={_isSafeObject:new n((!0),(!1),(!1),(!0))},s.PropertyDescriptor=n,s.registerConstructor(Object),s.registerConstructor(Array),s.registerConstructor(Date),s.registerConstructor(Map),s.registerConstructor(Set),"function"==typeof define&&define.amd?define(function(){return s}):"undefined"!=typeof module&&module.exports?module.exports=s:this[e]=s}("SafeObject");