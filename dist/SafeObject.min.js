"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();!function(e){function t(){"undefined"!=typeof console&&s.debugMode&&(console.warn?console.warn.apply(console,arguments):console.log&&console.log.apply(console,arguments))}var r=[],n=function(){function e(t,r,n,o,i){_classCallCheck(this,e),this.enumerable="undefined"==typeof r,this.writable="undefined"==typeof n,this.configurable="undefined"==typeof o;var c=s.getRegisteredConstructor(t);c?(this.value=c.construct.bind(c),this.isFactory=!0):(this.isFactory="function"==typeof t&&"undefined"==typeof i||(i||!1),this.value=t)}return _createClass(e,[{key:"clone",value:function(){return new e(this.value,this.enumerable,this.writable,this.configurable,this.isFactory)}},{key:"toObject",value:function(){return{value:this.isFactory?this.value(this):this.value,enumerable:this.enumerable,writable:this.writable,configurable:this.configurable}}}]),e}(),o=function(){function e(t){_classCallCheck(this,e),this.ConstructorFunction=t}return _createClass(e,[{key:"construct",value:function(){return new this.ConstructorFunction}}]),e}(),s=function(){function e(){_classCallCheck(this,e),e.setInstanceProperties(this,e.SAFE_OBJECT_INITIALIZE),this._isDestroyed=!1}return _createClass(e,null,[{key:"debug",value:function(t){var r=[];return r.push("----- SafeObject debug -----"),r.push("Constructor: "+String(t.constructor.name)),r.push("_isSafeObject: "+String(!!t._isSafeObject)),t._isSafeObject&&!function(){var n=e.getAncestors(t);r.push("Ancestors: "+n.map(function(e){return e.name}).join(" < "));var o=e.getRegisteredPropertyNames(t),s=t._getIgnoredSafeObjectPropertyNames().concat(o),i=Object.getOwnPropertyNames(t).filter(function(e){return s.indexOf(e)===-1});r.push("ignored properties: "+t._getIgnoredSafeObjectPropertyNames().join(", ")),r.push("registered properties: "+o.join(", ")),r.push("unregistered properties: "+i.join(", "))}(),r.join("\n")}},{key:"include",value:function(r){var o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(e.isSafeObject(r))return r;r.constructor.INSTANCE_PROPERTIES||(r.constructor.INSTANCE_PROPERTIES={});var s=r.constructor.INSTANCE_PROPERTIES;return"_isSafeObject"in s||(s._isSafeObject=new n((!0),(!1),(!1),(!1))),[{methodName:"destroy",returnsMerge:"super"},{methodName:"_getIgnoredSafeObjectPropertyNames",returnsMerge:"concat"}].forEach(function(i){function c(){var t=p.apply(this,arguments),r=e.prototype[u].call(this),n=void 0;switch(a){case"super":n=t;break;case"concat":n=(t||[]).concat(r||[])}return n}var u=i.methodName,a=i.returnsMerge,f=u in r,l="function"==typeof r[u],p=r[u];o.force&&f&&t("Overriding "+u+" method"),(f&&o.force||!f)&&(u in s||(s[u]=new n(l?c:e.prototype[u],(!1),(!0),(!0),(!1))))}),e.setProperties(r,e.SAFE_OBJECT_INITIALIZE,Object.assign(s,e.INSTANCE_PROPERTIES)),r}},{key:"getRegisteredConstructor",value:function(e){return r.find(function(t){return t.ConstructorFunction===e})}},{key:"registerConstructor",value:function(e){r.push(new o(e))}},{key:"unregisterConstructor",value:function(e){var t=r.findIndex(function(t){return t.ConstructorFunction===e});return r.splice(t,1)[0]}},{key:"isSafeObject",value:function(e){return e&&e._isSafeObject===!0}},{key:"getAncestors",value:function(e){for(var t=e.constructor,r=[];t=Object.getPrototypeOf(t.prototype)?Object.getPrototypeOf(t.prototype).constructor:null;)r.push(t||[]);return r}},{key:"getRegisteredProperties",value:function(t){var r=[t.constructor].concat(e.getAncestors(t)).map(function(e){return e.INSTANCE_PROPERTIES}).reverse();return r.unshift({}),Object.assign.apply(Object,_toConsumableArray(r))}},{key:"getUnregisteredPropertyNames",value:function(t){var r=e.getRegisteredPropertyNames(t);return r.push.apply(r,t._getIgnoredSafeObjectPropertyNames()),Object.getOwnPropertyNames(t).filter(function(e){return r.indexOf(e)===-1})}},{key:"getRegisteredPropertyNames",value:function(t){return Object.getOwnPropertyNames(e.getRegisteredProperties(t))}},{key:"setInstanceProperties",value:function(t,r){e.setProperties(t,r,e.getRegisteredProperties(t))}},{key:"setProperties",value:function(r,n,o){for(var s in o)try{var i=e.parsePropertyDescriptor(o[s]);e.setProperty(r,s,i,n)}catch(c){t("SafeObject#setProperties: "+c.toString())}}},{key:"setProperty",value:function(e,r,n,o){return n?void Object.defineProperty(e,r,n.toObject()):void t("Property descriptor isnt well formed for "+String(r)+".")}},{key:"parsePropertyDescriptor",value:function(e){return e&&e instanceof n?e:new n(e)}}]),_createClass(e,[{key:"destroy",value:function(){e.setInstanceProperties(this,e.SAFE_OBJECT_DESTROY),this._isDestroyed=!0}},{key:"_getIgnoredSafeObjectPropertyNames",value:function(){return["_isDestroyed"]}}]),e}();s.debugMode=!1,s.VERSION="1.2.0",s.SAFE_OBJECT_INITIALIZE=1,s.SAFE_OBJECT_DESTROY=2,s.INSTANCE_PROPERTIES={_isSafeObject:new n((!0),(!1),(!1),(!1))},s.PropertyDescriptor=n,s.registerConstructor(Object),s.registerConstructor(Array),s.registerConstructor(Date),s.registerConstructor(Map),s.registerConstructor(Set),"function"==typeof define&&define.amd?define(function(){return s}):"undefined"!=typeof module&&module.exports?module.exports=s:this[e]=s}("SafeObject");